---
title: 'A function for ggplot2: input strings for aes()'
author: ZERO
date: '2018-03-18'
slug: a-function-for-ggplot2-input-strings-for-aes
categories:
  - datavis and dataclean
tags:
  - ggplot2
thumbnailImagePosition: left
thumbnailImage: https://i.loli.net/2018/03/18/5aadb0bc4b1a8.jpg
metaAlignment: center
coverMeta: out
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,#show code and output
	message = FALSE,
	warning = FALSE
)
```

åœ¨æˆ‘å†™æ–‡ç« ç”»å›¾æ—¶ç»å¸¸é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šggplot2 åæ ‡è½´çš„è¾“å…¥ä¸æ”¯æŒè¾“å…¥æ•°æ®æ¡†çš„å˜é‡åï¼Œé€šå¸¸ä¼šæŠ¥é”™æ‰¾ä¸åˆ°å¯¹è±¡

#ğŸŒ°ï¼šé—®é¢˜æè¿°
data: [early senate poll](https://github.com/fivethirtyeight/data/tree/master/early-senate-polls)
```{r}
library(tidyverse) # general tasks
library(broom) # tidy model output
library(ggthemes) # style the plots

poll_data <- read_csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/early-senate-polls/early-senate-polls.csv")

glimpse(poll_data)
```
background: **there is a strong correlation between polling numbers and the ultimate result of an election**

##æ„å»ºæ¨¡å‹ï¼š çº¿æ€§æ¨¡å‹
```{r}
poll_lm <- lm(election_result ~ poll_average, data = poll_data)

summary(poll_lm)
```

##å†™ä¸ªå‡½æ•°ç”»å‡ºå› å˜é‡å’Œè‡ªå˜é‡çš„å…³ç³»

ç»“æœå‡ºç°äº†ä¸€ä¸ªä»¤æˆ‘è´¹è§£çš„æŠ¥é”™
```{r eval=FALSE, include=FALSE}
plot_model <- function(mod, explanatory, response) {
  augment(mod) %>%
  ggplot() +
    geom_point(aes(x = explanatory, y = response)) +
    geom_line(aes(x = explanatory, y = .fitted)) +
    theme_solarized() +
    theme(axis.title = element_text()) +
    labs(x = "Poll average", y = "Election results")
}
plot_model(poll_lm, poll_average, election_result)
```

> **Error in FUN(X[[i]], ...) : object 'poll_average' not found**

æˆ‘ä¸æ–­åœ°æ£€æŸ¥æˆ‘çš„æ‹¼å†™ï¼Œç›´åˆ°æˆ‘å¼€å§‹æ€€ç–‘äººç”Ÿ

#è§£å†³åŠæ³•ï¼š[**Define aesthetic mappings programatically**](http://ggplot2.tidyverse.org/reference/aes_.html)
```{r}
plot_model <- function(mod, explanatory, response, .fitted = ".fitted") {
  augment(mod) %>%
  ggplot() +
    geom_point(aes_string(x = explanatory, y = response), color = "#2CA58D") +
    geom_line(aes_string(x = explanatory, y = .fitted), color = "#033F63") +
    theme_solarized() +
    theme(axis.title = element_text()) +
    labs(x = "Poll average", y = "Election results")
}

plot_model(poll_lm, "poll_average", "election_result")
```

